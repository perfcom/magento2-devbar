<?php
/**
 * @copyright   perfcom.dev - https://perfcom.dev
 */

declare(strict_types=1);

/** @var \Perfcom\Devbar\Block\Sidebar $block */
/** @var \Magento\Framework\Escaper $escaper */
/** @var \Magento\Framework\View\Helper\SecureHtmlRenderer $secureRenderer */

?>

<style>
    #dev-helper-float-bar-container {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        z-index: 9999;
        margin-bottom: 20px
    }
    #dev-helper-float-bar {
        display: flex;
        gap: 8px;
        justify-content: space-between;
        align-items: center;
        max-width: 1200px;
        border-radius: 50px;
        margin: 0 auto;
        background: #2d3748;
        color: white;
        padding: 6px 15px;
        font-size: 12px;
        width: fit-content;
    }
    .bar-element-parent {
        display: flex;
        align-items: center;
        gap: 8px;
        border-radius: 50px;
        cursor: pointer;
    }
    .bar-element-parent-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 2px;
        column-gap: 8px;
        flex-shrink: 0;
        color: white;
    }
    .bar-element {
        flex-shrink: 0;
        display: flex;
        align-items: center;
        gap: 8px;
        border-radius: 50px;
        padding: 8px 15px;
        cursor: pointer;
        background-color: white;
        color: #2d3748;
        font-weight: 600;
        font-size: 12px;
    }
    .bar-element:hover {
        background-color: #19202c;
        color: white;
    }
    .bar-element-parent-grid span {
        font-size: 10px;
        line-height: 1.2;
    }
    .bar-minimize {
        color: white;
        padding: 8px;
        display: flex;
        align-items: center;
    }
    .bar-minimize:hover {
        color: #afc15e;
    }
</style>

<div id="dev-helper-float-bar-container">
    <div id="dev-helper-float-bar">
        <a style="flex-shrink: 0; fill: white; padding: 10px 0;"
            href="#" onclick="toggleDevBar();">
            <svg xmlns="http://www.w3.org/2000/svg" width="100px" height="24px" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2" viewBox="0 0 841 215"><path d="M51.841 214.736h864.798v276.99H51.841z" style="fill:none" transform="matrix(.97215 0 0 .7744 -50.397 -166.292)"/><path d="m125.246 245.468-3.6 16.968h-1.68l-.48-1.944c-.736.736-1.46 1.28-2.172 1.632-.712.352-1.532.528-2.46.528-1.008 0-1.852-.204-2.532-.612-.68-.408-1.148-.932-1.404-1.572a7.64 7.64 0 0 1-.492-2.16 6.647 6.647 0 0 1 .204-2.352c.384-1.76 1.068-3.196 2.052-4.308.984-1.112 2.332-1.668 4.044-1.668.768 0 1.412.128 1.932.384s1.004.688 1.452 1.296l1.416-6.192h3.72Zm-6 10.824c.272-1.024.3-1.82.084-2.388-.216-.568-.764-.86-1.644-.876-1.008-.032-1.748.212-2.22.732-.472.52-.82 1.3-1.044 2.34a9.474 9.474 0 0 0-.18 1.176c-.024.32-.008.668.048 1.044s.224.668.504.876c.28.208.668.32 1.164.336 1.008.016 1.752-.248 2.232-.792.48-.544.832-1.36 1.056-2.448ZM136.166 257.516h-8.352c-.16.832-.056 1.444.312 1.836.368.392.864.588 1.488.588 1.072 0 1.84-.4 2.304-1.2h4.128c-1.104 2.608-3.296 3.912-6.576 3.912-.976 0-1.82-.124-2.532-.372s-1.264-.588-1.656-1.02a4.72 4.72 0 0 1-.912-1.488 4.447 4.447 0 0 1-.288-1.788 14.18 14.18 0 0 1 .204-1.908c.896-4.16 3.352-6.192 7.368-6.096 1.2.032 2.184.272 2.952.72.768.448 1.292 1.044 1.572 1.788s.412 1.532.396 2.364c-.016.832-.152 1.72-.408 2.664Zm-3.36-2.544c.176-.704.104-1.256-.216-1.656-.32-.4-.8-.6-1.44-.6-1.312 0-2.224.752-2.736 2.256h4.392ZM151.718 250.196l-7.776 12.24h-4.224l-2.28-12.24h3.984l.96 8.856 4.848-8.856h4.488ZM163.118 256.58c-.384 1.76-1.1 3.212-2.148 4.356-1.048 1.144-2.492 1.716-4.332 1.716-1.76 0-3.096-.728-4.008-2.184l-1.344 1.968h-1.8l3.6-16.968h3.792l-1.272 5.928c1.152-.944 2.4-1.416 3.744-1.416.768 0 1.428.132 1.98.396s.972.612 1.26 1.044c.288.432.496.94.624 1.524.128.584.18 1.176.156 1.776-.024.6-.108 1.22-.252 1.86Zm-3.816-.288c.288-1.024.324-1.82.108-2.388-.216-.568-.772-.86-1.668-.876-.992-.032-1.724.208-2.196.72-.472.512-.82 1.296-1.044 2.352a8.706 8.706 0 0 0-.18 1.164c-.024.328-.008.676.048 1.044s.22.66.492.876c.272.216.648.332 1.128.348 1.024.016 1.772-.244 2.244-.78.472-.536.828-1.356 1.068-2.46ZM177.854 250.196l-2.592 12.24h-1.68l-.48-1.92c-.736.72-1.456 1.256-2.16 1.608-.704.352-1.52.528-2.448.528-1.008 0-1.852-.204-2.532-.612-.68-.408-1.152-.932-1.416-1.572a7.353 7.353 0 0 1-.504-2.148 6.597 6.597 0 0 1 .204-2.34c.384-1.76 1.1-3.2 2.148-4.32s2.484-1.68 4.308-1.68c1.808 0 3.152.72 4.032 2.16l1.32-1.944h1.8Zm-4.992 6.12c.272-1.024.3-1.82.084-2.388-.216-.568-.764-.86-1.644-.876-1.008-.032-1.748.212-2.22.732-.472.52-.82 1.308-1.044 2.364a8.706 8.706 0 0 0-.18 1.164 4.8 4.8 0 0 0 .048 1.056c.056.376.224.664.504.864.28.2.668.308 1.164.324 1.008.032 1.752-.228 2.232-.78.48-.552.832-1.372 1.056-2.46ZM186.71 249.98l-.744 3.312c-.88 0-1.6.156-2.16.468-.56.312-.956.668-1.188 1.068-.232.4-.404.904-.516 1.512l-1.296 6.096h-3.816l2.616-12.24h1.68l.456 1.896c1.088-1.36 2.744-2.064 4.968-2.112Z" style="fill-rule:nonzero" transform="matrix(10.63917 0 0 10.63919 -1160.131 -2595.735)"/></svg>
        </a>
        <div class="bar-element" style="background-color: #19202c; margin-left: 0; margin-right: auto; color: white;">
            <svg style="flex-shrink: 0;" xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4m0-4h.01"/></g></svg>
            <div class="bar-element-parent-grid">
                <span><strong>Database:</strong> <?= $block->escapeHtml($block->getDatabaseName()) ?></span>
                <span><strong>Magento:</strong> <?= $block->escapeHtml($block->getMagentoVersion()) ?></span>
                <span><strong>Search Engine:</strong> <?= $block->escapeHtml($block->getElasticsearchVersion()) ?></span>
                <span><strong>CSP Strict:</strong> <?= $block->escapeHtml($block->isCspStrictMode()) ?></span>
            </div>
        </div>
        <div class="bar-element-parent">
            <a class="bar-element"
                target="_blank"
                href="<?= $escaper->escapeUrl($block->getBackendUrl()) ?>">
                <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24"><path fill="currentColor" d="m12 24l-4.455-2.572v-12l2.97-1.715v12.001l1.485.902l1.485-.902V7.713l2.971 1.715v12zM22.391 6v12l-2.969 1.714V7.713L12 3.43L4.574 7.713v12.001L1.609 18V6L12 0z"/></svg>
                Backend
            </a>
            <form action="<?= $escaper->escapeUrl($block->getLoginUrl()) ?>" method="POST">
                <input type="hidden" name="form_key" value="<?= $escaper->escapeHtml($block->getFormKey()) ?>">
                <button type="submit" class="bar-element">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><circle cx="10" cy="7" r="4"/><path d="M10.3 15H7a4 4 0 0 0-4 4v2"/><circle cx="17" cy="17" r="3"/><path d="m21 21l-1.9-1.9"/></g></svg>
                    Login Random User
                </button>
            </form>
            <form action="<?= $escaper->escapeUrl($block->getAddToCartUrl()) ?>" method="POST">
                <input type="hidden" name="form_key" value="<?= $escaper->escapeHtml($block->getFormKey()) ?>">
                <button type="submit" class="bar-element">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M8 12h8m-4-4v8"/></g></svg>
                    Add Random Product
                </button>
            </form>
            <a class="bar-element"
                href="<?= $escaper->escapeUrl($block->getCheckoutUrl()) ?>">
                <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></g></svg>
                Checkout
            </a>
            <a class="bar-minimize" href="#" onclick="toggleDevBar();">
                <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24"><path fill="currentColor" d="M3.4 22L2 20.6L8.6 14H4v-2h8v8h-2v-4.6zM12 12V4h2v4.6L20.6 2L22 3.4L15.4 10H20v2z"/></svg>
            </a>
        </div>
    </div>
</div>

<?php
$scriptString = <<<script
function toggleDevBar() {
    const container = document.getElementById('dev-helper-float-bar-container');
    const bar = document.getElementById('dev-helper-float-bar');
    const elements = bar.querySelectorAll('.bar-element-parent, .bar-element:not(:last-child)');

    elements.forEach(el => {
        el.style.display = el.style.display === 'none' ? '' : 'none';
    });

    if (elements[0].style.display === 'none') {
        container.style.marginBottom = '-20px';
        document.cookie = 'dev_bar_collapsed=1; path=/; max-age=31536000';
    } else {
        container.style.marginBottom = '20px';
        document.cookie = 'dev_bar_collapsed=0; path=/; max-age=31536000';
    }
}

document.addEventListener('DOMContentLoaded', function() {
    const isCollapsed = document.cookie.includes('dev_bar_collapsed=1');
    if (isCollapsed) {
        toggleDevBar();
    }
});
script;
?>
<?= /* @noEscape */ $secureRenderer->renderTag('script', [], $scriptString, false) ?>
